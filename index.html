<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book Label Generator | Create Custom Labels</title>
<!-- Add Razorpay script -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary: #4F46E5;
  --primary-light: #818CF8;
  --primary-dark: #3730A3;
  --secondary: #10B981;
  --secondary-light: #34D399;
  --accent: #F59E0B;
  --dark: #1F2937;
  --light: #F9FAFB;
  --gray: #6B7280;
  --gray-light: #E5E7EB;
  --border-radius: 12px;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --transition: all 0.3s ease;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  padding: 20px;
  color: var(--dark);
}

.container {
  max-width: 1200px;
  margin: 0 auto;
}

header {
  text-align: center;
  margin-bottom: 30px;
  color: white;
}

header h1 {
  font-size: 2.8rem;
  font-weight: 800;
  margin-bottom: 8px;
  letter-spacing: -0.5px;
}

header p {
  font-size: 1.1rem;
  opacity: 0.9;
  max-width: 600px;
  margin: 0 auto;
}

.app-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  margin-bottom: 40px;
}

@media (max-width: 1024px) {
  .app-container {
    grid-template-columns: 1fr;
  }
}

/* Form Section */
.form-section {
  background: white;
  border-radius: var(--border-radius);
  padding: 30px;
  box-shadow: var(--shadow);
}

.section-title {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 2px solid var(--gray-light);
}

.section-title h2 {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--dark);
}

.section-title i {
  color: var(--primary);
  font-size: 1.3rem;
}

/* Upload Section */
.upload-section {
  margin-bottom: 30px;
}

.upload-container {
  border: 2px dashed var(--gray-light);
  border-radius: var(--border-radius);
  padding: 30px;
  text-align: center;
  transition: var(--transition);
  background: var(--light);
}

.upload-container:hover {
  border-color: var(--primary-light);
}

.upload-container.dragover {
  border-color: var(--primary);
  background: rgba(79, 70, 229, 0.05);
}

.upload-icon {
  font-size: 3rem;
  color: var(--primary);
  margin-bottom: 15px;
}

.upload-text {
  margin-bottom: 15px;
}

.upload-text h3 {
  font-size: 1.2rem;
  margin-bottom: 5px;
}

.upload-text p {
  color: var(--gray);
  font-size: 0.9rem;
}

.upload-btn {
  display: inline-block;
  background: var(--primary);
  color: white;
  padding: 12px 25px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.upload-btn:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

#photo {
  display: none;
}

.photo-preview {
  width: 150px;
  height: 180px;
  object-fit: cover;
  border-radius: 8px;
  margin-top: 20px;
  display: none;
  border: 3px solid var(--primary);
  box-shadow: var(--shadow);
}

/* Form Grid */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

@media (max-width: 768px) {
  .form-grid {
    grid-template-columns: 1fr;
  }
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--dark);
  display: flex;
  align-items: center;
  gap: 8px;
}

.form-group label i {
  color: var(--primary);
}

.form-group input {
  width: 100%;
  padding: 14px 16px;
  border: 2px solid var(--gray-light);
  border-radius: 8px;
  font-size: 1rem;
  transition: var(--transition);
  background: var(--light);
}

.form-group input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.form-group input::placeholder {
  color: var(--gray);
}

/* Preview Section */
.preview-section {
  background: white;
  border-radius: var(--border-radius);
  padding: 30px;
  box-shadow: var(--shadow);
  display: flex;
  flex-direction: column;
}

.preview-container {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(45deg, var(--light) 25%, transparent 25%, transparent 75%, var(--light) 75%),
              linear-gradient(45deg, var(--light) 25%, transparent 25%, transparent 75%, var(--light) 75%);
  background-size: 20px 20px;
  background-position: 0 0, 10px 10px;
  border-radius: 8px;
  padding: 20px;
  min-height: 400px;
}

canvas {
  border-radius: 8px;
  box-shadow: var(--shadow);
  max-width: 100%;
  height: auto;
}

/* Buttons */
.button-group {
  display: flex;
  gap: 15px;
  margin-top: 30px;
  flex-wrap: wrap;
}

.btn {
  padding: 15px 30px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 1rem;
  border: none;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  flex: 1;
  min-width: 200px;
}

.btn-primary {
  background: var(--primary);
  color: white;
}

.btn-primary:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(79, 70, 229, 0.2);
}

.btn-secondary {
  background: var(--secondary);
  color: white;
}

.btn-secondary:hover {
  background: var(--secondary-light);
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(16, 185, 129, 0.2);
}

.btn:disabled {
  background: var(--gray-light);
  color: var(--gray);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* Price Badge */
.price-badge {
  display: inline-flex;
  align-items: center;
  background: var(--accent);
  color: white;
  padding: 6px 15px;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.9rem;
  margin-left: 10px;
}

.price-badge::before {
  content: "‚Çπ";
  margin-right: 3px;
}

/* Payment Modal */
.payment-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1001;
  opacity: 0;
  visibility: hidden;
  transition: var(--transition);
}

.payment-modal.active {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: white;
  padding: 40px;
  border-radius: var(--border-radius);
  max-width: 500px;
  width: 90%;
  text-align: center;
  transform: translateY(-20px);
  transition: var(--transition);
}

.payment-modal.active .modal-content {
  transform: translateY(0);
}

.modal-content h3 {
  font-size: 1.8rem;
  margin-bottom: 15px;
  color: var(--dark);
}

.modal-content p {
  color: var(--gray);
  margin-bottom: 25px;
  line-height: 1.6;
}

.price-display {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--primary);
  margin: 20px 0;
}

.price-display::before {
  content: "‚Çπ";
}

.modal-buttons {
  display: flex;
  gap: 15px;
  margin-top: 30px;
}

.modal-btn {
  flex: 1;
  padding: 15px;
  border-radius: 8px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: var(--transition);
}

.modal-btn.confirm {
  background: var(--primary);
  color: white;
}

.modal-btn.confirm:hover {
  background: var(--primary-dark);
}

.modal-btn.cancel {
  background: var(--gray-light);
  color: var(--dark);
}

.modal-btn.cancel:hover {
  background: #d1d5db;
}

/* Features Section */
.features {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 40px;
}

.feature-card {
  background: white;
  padding: 25px;
  border-radius: var(--border-radius);
  box-shadow: var(--shadow);
  text-align: center;
  transition: var(--transition);
}

.feature-card:hover {
  transform: translateY(-5px);
}

.feature-icon {
  font-size: 2.5rem;
  color: var(--primary);
  margin-bottom: 15px;
}

.feature-card h3 {
  font-size: 1.2rem;
  margin-bottom: 10px;
  color: var(--dark);
}

.feature-card p {
  color: var(--gray);
  font-size: 0.95rem;
}

/* Footer */
footer {
  text-align: center;
  color: white;
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}

footer p {
  opacity: 0.8;
}

/* Toast Notification */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: var(--secondary);
  color: white;
  padding: 15px 25px;
  border-radius: 8px;
  box-shadow: var(--shadow);
  transform: translateY(100px);
  opacity: 0;
  transition: var(--transition);
  z-index: 1000;
}

.toast.show {
  transform: translateY(0);
  opacity: 1;
}

/* Responsive */
@media (max-width: 640px) {
  .app-container {
    gap: 20px;
  }
  
  .form-section, .preview-section {
    padding: 20px;
  }
  
  .btn {
    min-width: 100%;
  }
  
  .modal-buttons {
    flex-direction: column;
  }
  
  header h1 {
    font-size: 2rem;
  }
}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>üìö Book Label Generator</h1>
    <p>Create beautiful, professional book labels for students in minutes</p>
  </header>
  
  <div class="app-container">
    <!-- Left Column: Form -->
    <div class="form-section">
      <div class="section-title">
        <i>üìù</i>
        <h2>Student Information</h2>
      </div>
      
      <!-- Photo Upload -->
      <div class="upload-section">
        <div class="upload-container" id="dropZone">
          <div class="upload-icon">
            üì∏
          </div>
          <div class="upload-text">
            <h3>Upload Student Photo</h3>
            <p>Drag & drop or click to upload</p>
            <p>JPG or PNG, max 5MB</p>
          </div>
          <div class="upload-btn" id="uploadTrigger">
            Choose Photo
          </div>
          <input type="file" id="photo" accept="image/*">
          <img id="photoPreview" class="photo-preview" alt="Photo preview">
        </div>
      </div>
      
      <!-- Form Fields -->
      <div class="form-grid">
        <div class="form-group">
          <label for="name"><i>üë§</i> Student Name *</label>
          <input type="text" id="name" placeholder="Enter student name" required>
        </div>
        
        <div class="form-group">
          <label for="class"><i>üéì</i> Class *</label>
          <input type="text" id="class" placeholder="e.g., 10th" required>
        </div>
        
        <div class="form-group">
          <label for="roll"><i>üî¢</i> Roll Number</label>
          <input type="text" id="roll" placeholder="Enter roll number">
        </div>
        
        <div class="form-group">
          <label for="sec"><i>üìÇ</i> Section</label>
          <input type="text" id="sec" placeholder="e.g., A">
        </div>
        
        <div class="form-group" style="grid-column: span 2;">
          <label for="school"><i>üè´</i> School Name</label>
          <input type="text" id="school" placeholder="Enter school name">
        </div>
      </div>
      
      <!-- Action Buttons -->
      <div class="button-group">
        <button class="btn btn-primary" onclick="generateLabel()">
          <i>üé®</i> Generate Label
        </button>
        <button class="btn btn-secondary" onclick="initiatePayment()" id="downloadBtn" disabled>
          <i>üíæ</i> Download Image <span class="price-badge">20</span>
        </button>
      </div>
      
      <!-- Payment Info -->
      <div style="margin-top: 20px; padding: 15px; background: #F0F9FF; border-radius: 8px; text-align: center;">
        <p style="color: #0369A1; font-size: 0.9rem; margin: 0;">
          <strong>üí≥ Small Fee Required:</strong> ‚Çπ20 per download to support the service
        </p>
      </div>
    </div>
    
    <!-- Right Column: Preview -->
    <div class="preview-section">
      <div class="section-title">
        <i>üëÅÔ∏è</i>
        <h2>Label Preview</h2>
      </div>
      
      <div class="preview-container">
        <canvas id="canvas" width="600" height="350"></canvas>
      </div>
      
      <div class="button-group">
        <button class="btn" onclick="resetForm()" style="background: var(--gray-light);">
          <i>üîÑ</i> Reset Form
        </button>
      </div>
    </div>
  </div>
  
  <!-- Features -->
  <div class="features">
    <div class="feature-card">
      <div class="feature-icon">‚ö°</div>
      <h3>Fast & Easy</h3>
      <p>Create professional labels in seconds with our simple interface</p>
    </div>
    
    <div class="feature-card">
      <div class="feature-icon">üé®</div>
      <h3>Beautiful Design</h3>
      <p>Modern, clean design that looks great on any book</p>
    </div>
    
    <div class="feature-card">
      <div class="feature-icon">üì±</div>
      <h3>Mobile Friendly</h3>
      <p>Works perfectly on phones, tablets, and computers</p>
    </div>
    
    <div class="feature-card">
      <div class="feature-icon">üîí</div>
      <h3>Secure Payment</h3>
      <p>Safe and secure payments via Razorpay</p>
    </div>
  </div>
  
  <footer>
    <p>¬© 2026 Book Label Generator | Made with ‚ù§Ô∏è for students and teachers</p>
    <p>Devoloper Rishabh </p>
    <p style="font-size: 0.9rem; margin-top: 10px;">‚Çπ20 per download - Secure payments via Razorpay</p>
  </footer>
</div>

<!-- Payment Confirmation Modal -->
<div class="payment-modal" id="paymentModal">
  <div class="modal-content">
    <h3>Download Book Label</h3>
    <p>Download your custom book label image in high-quality PNG format.</p>
    
    <div class="price-display">10</div>
    
    <p style="font-size: 0.9rem; color: var(--gray);">
      Small fee to support the service. Secure payment via Razorpay.
    </p>
    
    <div class="modal-buttons">
      <button class="modal-btn confirm" onclick="processPayment()">
        Pay ‚Çπ10 & Download
      </button>
      <button class="modal-btn cancel" onclick="closePaymentModal()">
        Cancel
      </button>
    </div>
  </div>
</div>
<form><script src="https://checkout.razorpay.com/v1/payment-button.js" data-payment_button_id="pl_SC48J6D66LOF6M" async> </script> </form>
<!-- Toast Notification -->
<div class="toast" id="toast"></div>

<script>
// DOM Elements
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const photoInput = document.getElementById('photo');
const photoPreview = document.getElementById('photoPreview');
const uploadTrigger = document.getElementById('uploadTrigger');
const dropZone = document.getElementById('dropZone');
const downloadBtn = document.getElementById('downloadBtn');
const toast = document.getElementById('toast');
const paymentModal = document.getElementById('paymentModal');

// Variables
let uploadedImage = null;
let isImageLoaded = false;
let labelGenerated = false; // Track if label has been generated

// Initialize Canvas
function initializeCanvas() {
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // Draw placeholder design
  ctx.fillStyle = '#F3F4F6';
  ctx.font = 'bold 24px Inter, Arial';
  ctx.textAlign = 'center';
  ctx.fillText('Your label will appear here', canvas.width / 2, canvas.height / 2 - 20);
  
  ctx.fillStyle = '#9CA3AF';
  ctx.font = '16px Inter, Arial';
  ctx.fillText('Fill the form and click "Generate Label"', canvas.width / 2, canvas.height / 2 + 20);
  
  // Draw book icon
  drawBookIcon();
}

function drawBookIcon() {
  ctx.fillStyle = '#4F46E5';
  ctx.beginPath();
  ctx.moveTo(280, 180);
  ctx.lineTo(320, 160);
  ctx.lineTo(320, 240);
  ctx.lineTo(280, 260);
  ctx.closePath();
  ctx.fill();
  
  ctx.fillStyle = '#818CF8';
  ctx.beginPath();
  ctx.moveTo(280, 180);
  ctx.lineTo(280, 260);
  ctx.lineTo(240, 240);
  ctx.lineTo(240, 160);
  ctx.closePath();
  ctx.fill();
  
  ctx.fillStyle = '#3730A3';
  ctx.beginPath();
  ctx.moveTo(240, 160);
  ctx.lineTo(280, 180);
  ctx.lineTo(320, 160);
  ctx.lineTo(280, 140);
  ctx.closePath();
  ctx.fill();
}

// Toast Notification
function showToast(message, type = 'success') {
  toast.textContent = message;
  toast.style.background = type === 'error' ? '#EF4444' : '#10B981';
  toast.classList.add('show');
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// Image Upload Handlers
uploadTrigger.addEventListener('click', () => {
  photoInput.click();
});

photoInput.addEventListener('change', handleImageUpload);

// Drag and Drop
dropZone.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropZone.classList.add('dragover');
});

dropZone.addEventListener('dragleave', () => {
  dropZone.classList.remove('dragover');
});

dropZone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  
  const file = e.dataTransfer.files[0];
  if (file && file.type.match('image.*')) {
    photoInput.files = e.dataTransfer.files;
    handleImageUpload({ target: { files: [file] } });
  } else {
    showToast('Please drop an image file', 'error');
  }
});

function handleImageUpload(e) {
  const file = e.target.files[0];
  if (!file) return;
  
  if (!file.type.match('image.*')) {
    showToast('Please select an image file (JPG, PNG)', 'error');
    return;
  }
  
  if (file.size > 5 * 1024 * 1024) {
    showToast('Image size should be less than 5MB', 'error');
    return;
  }
  
  const reader = new FileReader();
  
  reader.onload = function(event) {
    uploadedImage = new Image();
    
    uploadedImage.onload = function() {
      isImageLoaded = true;
      photoPreview.src = event.target.result;
      photoPreview.style.display = 'block';
      showToast('Photo uploaded successfully!');
    };
    
    uploadedImage.onerror = function() {
      showToast('Failed to load image', 'error');
      isImageLoaded = false;
    };
    
    uploadedImage.src = event.target.result;
  };
  
  reader.readAsDataURL(file);
}

// Generate Label
function generateLabel() {
  const name = document.getElementById('name').value.trim();
  const className = document.getElementById('class').value.trim();
  const roll = document.getElementById('roll').value.trim();
  const section = document.getElementById('sec').value.trim();
  const school = document.getElementById('school').value.trim();
  
  if (!name || !className) {
    showToast('Please fill in Name and Class fields', 'error');
    return;
  }
  
  // Clear canvas
  ctx.fillStyle = '#ffffff';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // Draw gradient background
  const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
  gradient.addColorStop(0, '#4F46E5');
  gradient.addColorStop(0.1, '#ffffff');
  gradient.addColorStop(0.9, '#ffffff');
  gradient.addColorStop(1, '#10B981');
  
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  
  // Draw decorative border
  ctx.strokeStyle = '#4F46E5';
  ctx.lineWidth = 4;
  ctx.strokeRect(15, 15, canvas.width - 30, canvas.height - 30);
  
  // Draw header
  ctx.fillStyle = '#4F46E5';
  ctx.font = 'bold 32px Inter, Arial';
  ctx.textAlign = 'center';
  ctx.fillText('üìö This Book Belongs To', canvas.width / 2, 60);
  
  // Draw underline
  ctx.beginPath();
  ctx.moveTo(canvas.width / 2 - 150, 75);
  ctx.lineTo(canvas.width / 2 + 150, 75);
  ctx.strokeStyle = '#10B981';
  ctx.lineWidth = 2;
  ctx.stroke();
  
  // Draw photo area
  const photoX = 40;
  const photoY = 100;
  const photoWidth = 140;
  const photoHeight = 170;
  
  // Draw photo or placeholder
  if (uploadedImage && isImageLoaded) {
    try {
      // Draw photo with rounded corners
      ctx.save();
      ctx.beginPath();
      ctx.roundRect(photoX, photoY, photoWidth, photoHeight, 10);
      ctx.clip();
      
      // Calculate aspect ratio
      const imgRatio = uploadedImage.width / uploadedImage.height;
      const boxRatio = photoWidth / photoHeight;
      
      let drawWidth, drawHeight, drawX, drawY;
      
      if (imgRatio > boxRatio) {
        drawHeight = photoHeight;
        drawWidth = uploadedImage.width * (photoHeight / uploadedImage.height);
        drawX = photoX + (photoWidth - drawWidth) / 2;
        drawY = photoY;
      } else {
        drawWidth = photoWidth;
        drawHeight = uploadedImage.height * (photoWidth / uploadedImage.width);
        drawX = photoX;
        drawY = photoY + (photoHeight - drawHeight) / 2;
      }
      
      ctx.drawImage(uploadedImage, drawX, drawY, drawWidth, drawHeight);
      ctx.restore();
      
      // Draw photo border
      ctx.strokeStyle = '#4F46E5';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.roundRect(photoX, photoY, photoWidth, photoHeight, 10);
      ctx.stroke();
      
    } catch (error) {
      drawPhotoPlaceholder(photoX, photoY, photoWidth, photoHeight);
    }
  } else {
    drawPhotoPlaceholder(photoX, photoY, photoWidth, photoHeight);
  }
  
  // Draw student info
  const infoX = 220;
  let infoY = 120;
  const lineHeight = 40;
  
  // Info labels
  ctx.fillStyle = '#4F46E5';
  ctx.font = 'bold 22px Inter, Arial';
  ctx.textAlign = 'left';
  
  ctx.fillText('Name:', infoX, infoY);
  ctx.fillText('Class:', infoX, infoY + lineHeight);
  ctx.fillText('Roll No:', infoX, infoY + lineHeight * 2);
  ctx.fillText('Section:', infoX, infoY + lineHeight * 3);
  
  // Info values
  ctx.fillStyle = '#1F2937';
  ctx.font = '22px Inter, Arial';
  
  ctx.fillText(name || 'Not provided', infoX + 100, infoY);
  ctx.fillText(className || 'Not provided', infoX + 100, infoY + lineHeight);
  ctx.fillText(roll || 'Not provided', infoX + 100, infoY + lineHeight * 2);
  ctx.fillText(section || 'Not provided', infoX + 100, infoY + lineHeight * 3);
  
  // Draw school name
  if (school) {
    ctx.fillStyle = '#10B981';
    ctx.font = 'bold 24px Inter, Arial';
    ctx.textAlign = 'center';
    ctx.fillText(school, canvas.width / 2, 320);
  }
  
  // Draw decorative elements
  drawDecorativeElements();
  
  // Mark label as generated and enable download button
  labelGenerated = true;
  downloadBtn.disabled = false;
  
  showToast('Label generated successfully!');
}

function drawPhotoPlaceholder(x, y, width, height) {
  ctx.fillStyle = '#F3F4F6';
  ctx.beginPath();
  ctx.roundRect(x, y, width, height, 10);
  ctx.fill();
  
  ctx.strokeStyle = '#D1D5DB';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.roundRect(x, y, width, height, 10);
  ctx.stroke();
  
  // Draw camera icon
  ctx.fillStyle = '#9CA3AF';
  ctx.font = '60px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('üì∏', x + width / 2, y + height / 2);
  
  ctx.fillStyle = '#6B7280';
  ctx.font = '14px Inter, Arial';
  ctx.fillText('No photo', x + width / 2, y + height / 2 + 40);
}

function drawDecorativeElements() {
  // Draw decorative corner elements
  ctx.strokeStyle = '#4F46E5';
  ctx.lineWidth = 1;
  
  // Top-left corner
  ctx.beginPath();
  ctx.moveTo(30, 30);
  ctx.lineTo(50, 30);
  ctx.moveTo(30, 30);
  ctx.lineTo(30, 50);
  ctx.stroke();
  
  // Top-right corner
  ctx.beginPath();
  ctx.moveTo(canvas.width - 30, 30);
  ctx.lineTo(canvas.width - 50, 30);
  ctx.moveTo(canvas.width - 30, 30);
  ctx.lineTo(canvas.width - 30, 50);
  ctx.stroke();
  
  // Bottom-left corner
  ctx.beginPath();
  ctx.moveTo(30, canvas.height - 30);
  ctx.lineTo(50, canvas.height - 30);
  ctx.moveTo(30, canvas.height - 30);
  ctx.lineTo(30, canvas.height - 50);
  ctx.stroke();
  
  // Bottom-right corner
  ctx.beginPath();
  ctx.moveTo(canvas.width - 30, canvas.height - 30);
  ctx.lineTo(canvas.width - 50, canvas.height - 30);
  ctx.moveTo(canvas.width - 30, canvas.height - 30);
  ctx.lineTo(canvas.width - 30, canvas.height - 50);
  ctx.stroke();
  
  // Draw small book icons
  ctx.fillStyle = '#10B981';
  ctx.font = '24px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('üìò', 80, 320);
  ctx.fillText('üìó', canvas.width - 80, 320);
}

// Payment Functions
function initiatePayment() {
  if (!labelGenerated) {
    showToast('Please generate a label first', 'error');
    return;
  }
  
  // Show payment modal for all downloads
  paymentModal.classList.add('active');
}

function closePaymentModal() {
  paymentModal.classList.remove('active');
}

async function processPayment() {
  closePaymentModal();
  
  try {
    // Create order on your backend (Netlify function)
    const response = await fetch('/.netlify/functions/createOrder', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        amount: 2000, // 2000 paise = ‚Çπ20
        currency: 'INR'
      })
    });
    
    const orderData = await response.json();
    
    if (!orderData.id) {
      throw new Error('Failed to create order');
    }
    
    // Configure Razorpay options
    const options = {
      key: "rzp_live_SBFRjqhpikBmjf", // Replace with your Razorpay Key ID
      amount: orderData.amount, // Amount in paise (2000 = ‚Çπ20)
      currency: "INR",
      name: "Book Label Generator",
      description: "Download Custom Book Label",
      order_id: orderData.id,
      handler: function(response) {
        // Payment successful
        console.log('Payment successful:', response);
        downloadLabelDirectly();
        showToast('Payment successful! Label downloaded.');
      },
      prefill: {
        name: document.getElementById('name').value.trim() || '',
        email: "", // You can collect email if needed
        contact: "" // You can collect phone if needed
      },
      theme: {
        color: "#4F46E5"
      },
      modal: {
        ondismiss: function() {
          showToast('Payment cancelled', 'error');
        }
      }
    };
    
    // Open Razorpay checkout
    const rzp = new Razorpay(options);
    rzp.open();
    
  } catch (error) {
    console.error('Payment error:', error);
    showToast('Payment failed. Please try again.', 'error');
  }
}

// Direct download (after successful payment)
function downloadLabelDirectly() {
  try {
    const link = document.createElement('a');
    const name = document.getElementById('name').value.trim() || 'student';
    const className = document.getElementById('class').value.trim() || '';
    
    const filename = `Book-Label-${name.replace(/\s+/g, '-')}${className ? '-' + className : ''}.png`;
    
    link.download = filename;
    link.href = canvas.toDataURL('image/png');
    link.click();
    
    showToast('Label downloaded successfully!');
    
  } catch (error) {
    console.error('Download error:', error);
    showToast('Error downloading label', 'error');
  }
}

// Old download function (compatibility)
function downloadLabel() {
  initiatePayment();
}

// Reset Form
function resetForm() {
  document.getElementById('name').value = '';
  document.getElementById('class').value = '';
  document.getElementById('roll').value = '';
  document.getElementById('sec').value = '';
  document.getElementById('school').value = '';
  photoInput.value = '';
  uploadedImage = null;
  isImageLoaded = false;
  photoPreview.style.display = 'none';
  downloadBtn.disabled = true;
  labelGenerated = false;
  
  initializeCanvas();
  showToast('Form reset successfully');
}

// Initialize
window.onload = function() {
  initializeCanvas();
  
  // Add roundRect support if not available
  if (!CanvasRenderingContext2D.prototype.roundRect) {
    CanvasRenderingContext2D.prototype.roundRect = function(x, y, width, height, radius) {
      if (typeof radius === 'number') {
        radius = {tl: radius, tr: radius, br: radius, bl: radius};
      } else {
        radius = {...{tl: 0, tr: 0, br: 0, bl: 0}, ...radius};
      }
      
      this.moveTo(x + radius.tl, y);
      this.lineTo(x + width - radius.tr, y);
      this.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
      this.lineTo(x + width, y + height - radius.br);
      this.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
      this.lineTo(x + radius.bl, y + height);
      this.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
      this.lineTo(x, y + radius.tl);
      this.quadraticCurveTo(x, y, x + radius.tl, y);
    };
  }
  
  // Add test data for demo
  setTimeout(() => {
    if (confirm('Would you like to load demo data to test the generator?')) {
      document.getElementById('name').value = 'Emma Wilson';
      document.getElementById('class').value = '10th Grade';
      document.getElementById('roll').value = '25';
      document.getElementById('sec').value = 'A';
      document.getElementById('school').value = 'Greenwood International School';
      showToast('Demo data loaded. Click "Generate Label" to see the result!');
    }
  }, 1000);
};
</script>
</body>
</html>
